DROP TABLE Estudiantes;
DROP TABLE Carreras;


--Punto2
CREATE TABLE Carreras(
    id_carrera NUMBER(5, 0) NOT NULL,
    nombre_carrera VARCHAR2(60) NOT NULL,
    semestres NUMBER(1, 0),
    CONSTRAINT pk_carrera PRIMARY KEY (id_carrera)
);


INSERT INTO Carreras(id_carrera, nombre_carrera, semestres) VALUES (100, 'Inge Siestema', 8);
INSERT INTO Carreras(id_carrera, nombre_carrera, semestres) VALUES (200, 'Inge Mecanica', 9);
INSERT INTO Carreras(id_carrera, nombre_carrera, semestres) VALUES (300, 'Biomedica', 7);
INSERT INTO Carreras(id_carrera, nombre_carrera, semestres) VALUES (400, 'Comunicacion Social', 10);
INSERT INTO Carreras(id_carrera, nombre_carrera, semestres) VALUES (500, 'Artes', 8);

--Punto1
CREATE TABLE Estudiantes(
    num_id NUMBER(10,0) GENERATED BY DEFAULT AS IDENTITY,
    id_carrera NUMBER(5,0) NOT NULL,
    cod_est varchar2(20) not NULL,
    nombre varchar2(40) not NULL,
    apellidos varchar2(40) not NULL,
    promedio_carrera number(5,2),
    valor_Psemestre number(10,2),
    fecha_nacimiento DATE,
    fecha_inscripcion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    aprobado varchar(1), 
    edad number(2),
    no_hermanos number(2),
    comentario_mat varchar2(1024),
    CONSTRAINT estudiantes_pk PRIMARY KEY(num_id),
    --CONSTRAINT estudiantes_uk UNIQUE(cod_est),
    CONSTRAINT estudiantes_ck1 CHECK (aprobado in ('T', 'F')),
    CONSTRAINT fk_carrera FOREIGN KEY (id_carrera) REFERENCES Carreras(id_carrera)
);

--Punto2
INSERT INTO ESTUDIANTES (ID_CARRERA, COD_EST, NOMBRE, APELLIDOS, PROMEDIO_CARRERA, VALOR_PSEMESTRE, APROBADO, EDAD, NO_HERMANOS, COMENTARIO_MAT, FECHA_NACIMIENTO) VALUES (100, '10', 'Pedro', 'Gonzales', 0.0, 900000, 'F', '20', '1', 'Sin revisar',TO_DATE ('2004/09/25','YYYY/MM/DD'));
INSERT INTO ESTUDIANTES (ID_CARRERA, COD_EST, NOMBRE, APELLIDOS, PROMEDIO_CARRERA, VALOR_PSEMESTRE, APROBADO, EDAD, NO_HERMANOS, COMENTARIO_MAT, FECHA_NACIMIENTO) VALUES (500, '11', 'Juan', 'Vasquez', 0.0, 1000000, 'F', '18', '0', 'Sin revisar',TO_DATE ('2004/08/23','YYYY/MM/DD'));
INSERT INTO ESTUDIANTES (ID_CARRERA, COD_EST, NOMBRE, APELLIDOS, PROMEDIO_CARRERA, VALOR_PSEMESTRE, APROBADO, EDAD, NO_HERMANOS, COMENTARIO_MAT, FECHA_NACIMIENTO) VALUES (100, '12', 'Ana', 'Velasquez', 0.0, 800000, 'F', '18', '0', 'Sin revisar',TO_DATE ('2005/03/18','YYYY/MM/DD'));
INSERT INTO ESTUDIANTES (ID_CARRERA, COD_EST, NOMBRE, APELLIDOS, PROMEDIO_CARRERA, VALOR_PSEMESTRE, APROBADO, EDAD, NO_HERMANOS, COMENTARIO_MAT, FECHA_NACIMIENTO) VALUES (300, '13', 'Orlando', 'Sanchez', 0.0, 600000, 'F', '19', '0', 'Sin revisar',TO_DATE ('2003/05/09','YYYY/MM/DD'));
INSERT INTO ESTUDIANTES (ID_CARRERA, COD_EST, NOMBRE, APELLIDOS, PROMEDIO_CARRERA, VALOR_PSEMESTRE, APROBADO, EDAD, NO_HERMANOS, COMENTARIO_MAT, FECHA_NACIMIENTO) VALUES (200, '14', 'Daniela', 'Galan', 0.0, 1200000, 'F', '20', '0', 'Sin revisar',TO_DATE ('2005/12/30','YYYY/MM/DD'));
INSERT INTO ESTUDIANTES (ID_CARRERA, COD_EST, NOMBRE, APELLIDOS, PROMEDIO_CARRERA, VALOR_PSEMESTRE, APROBADO, EDAD, NO_HERMANOS, COMENTARIO_MAT, FECHA_NACIMIENTO) VALUES (100, '15', 'Andrea', 'Arenas', 0.0, 900000, 'F', '21', '0', 'Sin revisar',TO_DATE ('2004/01/01','YYYY/MM/DD'));
INSERT INTO ESTUDIANTES (ID_CARRERA, COD_EST, NOMBRE, APELLIDOS, PROMEDIO_CARRERA, VALOR_PSEMESTRE, APROBADO, EDAD, NO_HERMANOS, COMENTARIO_MAT, FECHA_NACIMIENTO) VALUES ( 500,'16', 'Martin', 'Gonzales', 0.0, 1600000, 'F', '17', '0', 'Sin revisar',TO_DATE ('2003/02/20','YYYY/MM/DD'));
INSERT INTO ESTUDIANTES (ID_CARRERA, COD_EST, NOMBRE, APELLIDOS, PROMEDIO_CARRERA, VALOR_PSEMESTRE, APROBADO, EDAD, NO_HERMANOS, COMENTARIO_MAT, FECHA_NACIMIENTO) VALUES (200, '17', 'Tatiana', 'Vivas', 0.0, 1600000, 'F', '19', '0', 'Sin revisar',TO_DATE ('2004/09/24','YYYY/MM/DD'));
INSERT INTO ESTUDIANTES (ID_CARRERA, COD_EST, NOMBRE, APELLIDOS, PROMEDIO_CARRERA, VALOR_PSEMESTRE, APROBADO, EDAD, NO_HERMANOS, COMENTARIO_MAT, FECHA_NACIMIENTO) VALUES ( 100,'18', 'Camila', 'Lugo', 0.0, 1100000, 'F', '17', '0', 'Sin revisar',TO_DATE ('2005/04/15','YYYY/MM/DD'));
INSERT INTO ESTUDIANTES (ID_CARRERA, COD_EST, NOMBRE, APELLIDOS, PROMEDIO_CARRERA, VALOR_PSEMESTRE, APROBADO, EDAD, NO_HERMANOS, COMENTARIO_MAT, FECHA_NACIMIENTO) VALUES (500, '19', 'Eugenia', 'Vasquez', 0.0, 1000000, 'F', '18', '0', 'Sin revisar',TO_DATE ('2004/12/12','YYYY/MM/DD'));
COMMIT;

--Punto 5
create view PUNTO5 as(
SELECT  
    E.NUM_ID, E.COD_EST, E.NOMBRE, E.APELLIDOS, E.PROMEDIO_CARRERA, E.VALOR_PSEMESTRE, E.APROBADO, E.EDAD, E.NO_HERMANOS, E.COMENTARIO_MAT,
    E.ID_CARRERA, c.nombre_carrera, c.semestres 
FROM 
    ESTUDIANTES E,CARRERAS C 
WHERE 
    E.id_carrera = C.id_carrera  
    );
    
    GRANT
    SELECT 
    ON
    is354917.PUNTO5
    TO
    jleon;
--Punto 6
create view PUNTO6 as(
SELECT 
    E.NUM_ID, E.COD_EST, E.NOMBRE, E.APELLIDOS, E.PROMEDIO_CARRERA Promedio,TO_CHAR(E.fecha_nacimiento, 'YYYY/MM/DD') fecha_nacimiento, 
    E.ID_CARRERA, c.nombre_carrera, c.semestres
FROM 
    ESTUDIANTES E,
    CARRERAS C
WHERE 
    E.id_carrera = C.id_carrera AND
    E.fecha_nacimiento >= TO_DATE('2004/01/01','YYYY/MM/DD')
    );
    GRANT
    SELECT 
    ON
    is354917.PUNTO6
    TO
    jleon;

ALTER TABLE ESTUDIANTES ADD puntuaje_icfes NUMBER(3,0);
ALTER TABLE ESTUDIANTES DROP COLUMN PROMEDIO_CARRERA;

DELETE FROM ESTUDIANTES WHERE ID_CARRERA = 200;
DELETE FROM ESTUDIANTES WHERE NOMBRE = 'Martin';

ALTER TABLE ESTUDIANTES DROP CONSTRAINT fk_carrera;
ALTER TABLE Carreras DROP COLUMN id_carrera;
DROP TABLE CARRERAS;


